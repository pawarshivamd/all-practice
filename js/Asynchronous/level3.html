<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    ğŸ§­ Intermediate: Chaining and Sequencing
    3. Chaining Promises (Multi-Step Preparation)
    Task: Simulate a two-step process using Promise chaining.

    Create a function prepIngredients that resolves after 1 second with "âœ… Ingredients prepped.".

    Create a function cookMeal that takes the result of the first step as an argument and resolves after 3 seconds with
    "ğŸ½ Meal is cooked and ready!".

    Call prepIngredients() and chain it to cookMeal(). Use a final .then() to log the end result.
</body>
<script>
    const prepIngredients = (() => {
        return new Promise((res, rej) => {
            setTimeout(() => {
                res("âœ… Ingredients prepped.")
            }, 1000)
        })
    })
    const cookMeal = ((prepResult) => {
        console.log(`22 ${prepResult}`)
        return new Promise((res, rej) => {
            setTimeout(() => {
                res("ğŸ½ Meal is cooked and ready!")
            }, 3000);
        })
    })

    prepIngredients()
        .then((prepResult) => {
            return cookMeal(prepResult)
        }).then((fin) => {
            console.log(`final result ${fin}`)
        }).catch((error) => console.log(error))


    // function fetchUser(userId) {
    //     return new Promise((res, rej) => {
    //         setTimeout(() => {
    //             res({ id: userId, username: "Alice_Pro", role: "Admin" })
    //         }, 2000);
    //     })
    // }

    // function fetchPermissions(userObject) {
    //     return new Promise((res, rej) => {
    //         res({ canEdit: true, canDelete: userObject.role === "Admin" })
    //     })
    // }
    // fetchUser(101).then((userId) => {
    //     console.log(userId)
    //     return fetchPermissions(userId)
    // }).then((finout) => console.log("final output ...", finout)).catch((e) => console.log(e))1

    // --- 1. User Fetching Function (2s delay) ---
    function fetchUser(userId) {
        return new Promise((res, rej) => {
            console.log(`1. Fetching user ${userId}... (2s)`);
            setTimeout(() => {
                const user = { id: userId, username: "Alice_Pro", role: "Admin" };
                res(user);
            }, 2000);
        })
    }

    // --- 2. Permissions Fetching Function (Takes userObject as argument, 1s delay) ---
    function fetchPermissions(userObject) {
        return new Promise((res, rej) => {
            console.log(`2. User fetched. Checking permissions for role: ${userObject.role} (1s)`);
            setTimeout(() => { // â¬…ï¸ 1s delay
                const permissions = { 
                    canEdit: true, 
                    canDelete: userObject.role === "Admin" 
                };
                res(permissions);
            }, 1000);
        })
    }

    // --- 3. Promise Chaining Implementation ---
    fetchUser(101)
        .then((userObject) => {
            // àª…àª¹à«€àª‚ 'userObject' àª®àª¾àª‚ fetchUser àª¦à«àªµàª¾àª°àª¾ Resolve àª¥àª¯à«‡àª²à«àª‚ àª“àª¬à«àªœà«‡àª•à«àªŸ àª›à«‡.
            console.log("   User Object Received:", userObject); 
            
            // ğŸ›‘ RETURN àª¸à«àªŸà«‡àªŸàª®à«‡àª¨à«àªŸ àªªàª¹à«‡àª²àª¾àª‚ àª²à«‹àª— àª•àª°à«‹ 
            console.log("   â¡ï¸ Returning fetchPermissions Promise..."); 
            
            // Promise Chaining àª®àª¾àªŸà«‡ àª…àª¹à«€àª‚ àª¬à«€àªœàª¾ Promise àª¨à«‡ RETURN àª•àª°àªµà«àª‚ àªœàª°à«‚àª°à«€ àª›à«‡.
            return fetchPermissions(userObject); 
        })
        .then((finalPermissions) => {
            // àª…àª¹à«€àª‚ 'finalPermissions' àª®àª¾àª‚ fetchPermissions àª¦à«àªµàª¾àª°àª¾ Resolve àª¥àª¯à«‡àª²à«àª‚ àª“àª¬à«àªœà«‡àª•à«àªŸ àª›à«‡.
            console.log("---------------------------------------");
            console.log("ğŸ‰ Final Output (Permissions):", finalPermissions);
            console.log("Total Time: ~3 seconds (2s + 1s)");
            console.log("---------------------------------------");
        })
        .catch((e) => console.error("âŒ An Error Occurred:", e));
</script>

</html>